# ğŸ“… Feriado Worker Service (.NET 10)

Este projeto Ã© um **Worker Service** desenvolvido em **.NET 10** que executa em segundo plano para verificar e armazenar feriados Nacionais (Brasil) e Estaduais (SÃ£o Paulo) em um banco de dados **MySQL**.

O serviÃ§o consulta periodicamente a API pÃºblica [Nager.Date](https://date.nager.at/) e salva novos registros no banco de dados, evitando duplicidade.

---

## ğŸš€ Tecnologias Utilizadas

* **Linguagem:** C# (.NET 10)
* **Tipo de Projeto:** Worker Service (Background Service)
* **Banco de Dados:** MySQL 8.0 (via Docker)
* **ORM:** Entity Framework Core (Pomelo)
* **API Externa:** Nager.Date (API PÃºblica Gratuita)
* **ContainerizaÃ§Ã£o:** Docker & Docker Compose

---

## ğŸ“‹ PrÃ©-requisitos

* [.NET 10 SDK](https://dotnet.microsoft.com/download) instalado
* [Docker](https://www.docker.com/) e **Docker Compose** instalados e rodando
* Cliente MySQL (MySQL Workbench, DBeaver) para rodar o script inicial

---

## ğŸ”„ Fluxo de ExecuÃ§Ã£o
```mermaid
graph TD
    A[Start Application] --> B[Inicializa DI e ConfiguraÃ§Ãµes]
    B --> C{Worker Loop}
    C -->|Acorda| D[Chama HolidayService]
    D -->|GET Request| E[API Nager.Date]
    E -->|Retorna JSON| D
    D -->|Filtra Nacionais + SP| F[Lista de Datas]
    F --> G[Abre Escopo do Banco MySQL]
    G --> H{Data jÃ¡ existe no Banco?}
    H -- Sim --> I[Ignora]
    H -- NÃ£o --> J[Adiciona para InserÃ§Ã£o]
    J --> K[SaveChanges - Commit]
    K --> L[Log: X novos feriados]
    L --> M[Dorme por 24 horas]
    M --> C
```

---

## ğŸ› ï¸ ConfiguraÃ§Ã£o e InstalaÃ§Ã£o

### 1. Subir o Banco de Dados (Docker)

O projeto possui um arquivo `docker-compose.yml` configurado para rodar o MySQL 8.0.

Na raiz do projeto (`feriado-work/`), execute:
```bash
docker compose up -d
```

**Dados de ConexÃ£o do Container:**
* Host: `localhost` (ou `127.0.0.1`)
* Porta Externa: `3307` (Mapeada para 3306 interna)
* UsuÃ¡rio: `root`
* Senha: `sua_senha`
* Database: `feriados_db`

### 2. Criar a Tabela (Script SQL)

Como o serviÃ§o nÃ£o cria a tabela automaticamente (por design), conecte-se ao banco usando seu cliente preferido (na porta 3307) e execute o script abaixo:
```sql
CREATE DATABASE IF NOT EXISTS feriados_db;
USE feriados_db;

CREATE TABLE IF NOT EXISTS feriados (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    data DATE NOT NULL
);
```

### 3. ConfiguraÃ§Ã£o da AplicaÃ§Ã£o

Verifique o arquivo `backend/appsettings.Development.json`. A string de conexÃ£o deve apontar para a porta 3307:
```json
"ConnectionStrings": {
  "DefaultConnection": "Server=localhost;Port=3307;Database=feriados_db;User=root;Password=sua_senha;"
}
```

---

## â–¶ï¸ Como Rodar

Navegue atÃ© a pasta do backend e execute o projeto:
```bash
cd backend
dotnet run
```

**O que esperar no console:**

O Worker irÃ¡ iniciar, consultar a API e logar o progresso:
```
info: feriado.Worker[0]
      Verificando feriados (Nacionais e SP)... 14/02/2026 10:00:00 -03:00
info: feriado.Worker[0]
      12 novos feriados adicionados.
```

O serviÃ§o ficarÃ¡ em execuÃ§Ã£o e verificarÃ¡ novamente a cada 24 horas.

---

## ğŸ“‚ Estrutura do Projeto
```
feriado-work/
â”œâ”€â”€ docker-compose.yml        # ConfiguraÃ§Ã£o do MySQL em Container
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ Data/
â”‚   â”‚   â””â”€â”€ AppDbContext.cs   # Contexto do EF Core
â”‚   â”œâ”€â”€ Models/
â”‚   â”‚   â””â”€â”€ Feriado.cs        # Modelo da tabela (ID, Data)
â”‚   â”œâ”€â”€ Services/
â”‚   â”‚   â””â”€â”€ HolidayService.cs # LÃ³gica de consumo da API Nager.Date
â”‚   â”œâ”€â”€ Worker.cs             # ServiÃ§o em Background (Loop principal)
â”‚   â”œâ”€â”€ Program.cs            # InjeÃ§Ã£o de dependÃªncia e Startup
â”‚   â””â”€â”€ appsettings.json      # ConfiguraÃ§Ãµes de ambiente
```

---

## ğŸ” Detalhes da API

O serviÃ§o consome a rota:
```
GET https://date.nager.at/api/v3/publicholidays/{YEAR}/BR
```

**LÃ³gica de Filtragem:**

O sistema salva apenas se:
1. O feriado for Global (Nacional)
2. OU se o feriado for especÃ­fico da regiÃ£o `BR-SP` (Estado de SÃ£o Paulo)

---

## ğŸ“ LicenÃ§a

Este projeto Ã© para fins de estudo e portfÃ³lio.